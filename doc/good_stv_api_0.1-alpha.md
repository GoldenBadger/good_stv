FORMAT: 1A
HOST: https://example.com/api/v1

# Good STV

Good STV is a simple API allowing a group of people to vote on a minor election,
such as a student society committee position.

# Poll collection [/polls]

## Create a poll [POST]

This action creates a new poll. It takes a JSON object containing a title and a
list of candidates.

*   Request (application/json)

    *   Attributes

        *   `poll` (`string`) - The poll name. Limit 32 characters.
        *   `choices` (`array[string]`) - The names of each of the candidates.

    *   Body

    ```
    {
        "poll": "Redbrick treasurer election.",
        "candidates": [
            "Alice",
            "Bob",
            "Charlie"
        ]
    }
    ```

*   Response 201 (application/json)

    *   Headers

    ```
    Location: /polls/a1b2c3
    ```

    *   Body
        *   Attributes
        *   `id` (`string`, 6 characters) - ID of the poll, generated by the
            server.

    ```json
    {
        "admin_key": "abcdefg123456",
        "id": "a1b2c3"
    }
    ```

# Poll [/polls/{id}]

*   Parameters
    *   `id`: `a1b2c3` (string a-z0-9, required) - Unique identifier for the
        poll

## View details of a poll [GET]

*   Response 200 (application/json)

    ```json
    {
        "poll": "Redbrick treasurer election.",
        "created_at": "2019-01-18T14:38:20,307253825+00:00",
        "in_progress": "true",
        "candidates": [
            {
                "id": "alice",
                "name": "Alice"
            }, {
                "id": "bob_smith",
                "name": "Bob Smith"
            }, {
                "id": "charlie",
                "name": "Charlie"
            }
        ]
    }
    ```

## Submit a vote [POST]

Submit preferences for a candidate/set of candidates. This action sets a cookie
with the poll id so that a browser cannot vote in the same poll twice.

*   Attributes

    *   `preferences`: `["bob_smith", "alice", "charlie"]` (array of strings) -
        Ordered list of candidate ids, ordered from most preferred to least
        preferred.

*   Response 201

    *   Headers

    ```
    Set-Cookie: voted_a1b2c3=true
    ```

# Poll results [/polls/{id}/results]

Only the admin (the creator of the poll) can view the poll results.

*   Parameters
    *   `id`: `a1b2c3` (string a-z0-9, required) - Unique identifier for the
        poll.

## Close the poll and calculate the results [POST]

This requires the admin key provided on creation of the poll. This sets the
`in_progress` field of the poll to false, and prevents further votes.

*   Attributes

    *   `admin_key` (`string`) - The admin key provided on poll creation.

*   Request (application/json)

    ```json
    {
        "admin_key": "abcdefg123456"
    }
    ```

*   Response 200

## View the results of the poll [GET]

Returns the list of candidates, ordered by number of 1st preference votes as of
the final round, descending.

*   Response 200 (application/json)

    ```json
    {
        "created_at": "2019-01-18T15:11:46,859932952+00:00",
        "results": [
            { "id": "bob_smith", "votes": 100 },
            { "id": "alice", "votes": 70 },
            { "id": "charlie", "votes": 15 }
        ]
    }
    ```
